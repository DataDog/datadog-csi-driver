apiVersion: v1
kind: Pod
metadata:
  name: consumer-library
spec:
  containers:
  - name: consumer-library
    image: busybox
    command: ["/bin/sh", "-c"]
    args:
      - |
        set -e

        # Verify library contents
        test -d /test-library
        test -f /test-library/version
        test "$(cat /test-library/version)" = "1.14.1"
        test -f /test-library/requirements.json
        test -d /test-library/trace
        test -d /test-library/appsec

        echo "Library test passed"

        sleep 3600
    volumeMounts:
    - name: dd-library-volume
      mountPath: /test-library
      readOnly: true
  volumes:
  - name: dd-library-volume
    csi:
      driver: k8s.csi.datadoghq.com
      volumeAttributes:
        type: DatadogLibrary
        dd.csi.datadog.com/library.package: dd-lib-php-init
        dd.csi.datadog.com/library.registry: gcr.io/datadoghq
        dd.csi.datadog.com/library.version: v1.14.1
