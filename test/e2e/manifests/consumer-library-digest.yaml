apiVersion: v1
kind: Pod
metadata:
  name: consumer-library-digest
spec:
  containers:
  - name: consumer-library-digest
    image: busybox
    command: ["/bin/sh", "-c"]
    args:
      - |
        set -e

        # Verify library contents (same as v1.14.1 since we use its digest)
        test -d /test-library
        test -f /test-library/version
        test "$(cat /test-library/version)" = "1.14.1"
        test -f /test-library/requirements.json
        test -d /test-library/trace
        test -d /test-library/appsec

        echo "Library digest test passed"

        sleep 3600
    volumeMounts:
    - name: dd-library-volume
      mountPath: /test-library
      readOnly: true
  volumes:
  - name: dd-library-volume
    csi:
      driver: k8s.csi.datadoghq.com
      readOnly: true
      volumeAttributes:
        type: DatadogLibrary
        dd.csi.datadog.com/library.package: dd-lib-php-init
        dd.csi.datadog.com/library.registry: gcr.io/datadoghq
        # Using digest instead of tag (same content as v1.14.1)
        dd.csi.datadog.com/library.version: sha256:a9fd46c59f907417fa660c42a614a87729cd5fd89ed372718fc8b512da8738ec
