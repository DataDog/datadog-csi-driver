apiVersion: v1
kind: Pod
metadata:
  name: consumer-library-custom-source
spec:
  containers:
  - name: consumer-library-custom-source
    image: busybox
    command: ["/bin/sh", "-c"]
    args:
      - |
        set -e

        # Verify library contents with custom source path
        test -d /test-library
        test -f /test-library/README
        test -f /test-library/copy-lib.sh
        test -d /test-library/package

        echo "Library custom source test passed"

        sleep 3600
    volumeMounts:
    - name: dd-library-volume
      mountPath: /test-library
      readOnly: true
  volumes:
  - name: dd-library-volume
    csi:
      driver: k8s.csi.datadoghq.com
      volumeAttributes:
        type: DatadogLibrary
        dd.csi.datadog.com/library.image: gcr.io/datadoghq/dd-lib-php-init:v1.14.1
        dd.csi.datadog.com/library.source: /datadog-init

